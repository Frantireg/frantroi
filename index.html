<!DOCTYPE html>
<html lang="es">
<head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Generador de CUPS (Archivo √önico)</title>
        <style>
            /* PALETA 60-30-10 (Pastel) */
            :root {
                /* 60% Dominante: Blanco Roto (Fondo de Recuadros/Contenedor) */
                --color-dominante: #F5F5F5;
                /* 30% Secundario: Lavanda Muy Claro (Fondo de P√°gina) */
                --color-secundARIO: #E8EAF6;
                /* 10% Acento: Menta Suave (Botones Copiar, Borde) */
                --color-acento: #A8DAD7;
                /* Contraste: P√∫rpura del Logo (T√≠tulos, Bot√≥n Generar) */
                --color-contraste: #6A5ACD;
                /* Gris Suave (Texto general) */
                --color-texto-general: #555555;
            }


            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                margin: 0;
                padding: 20px;
                background-color: var(--color-secundario);
            }
            .header {
                display: flex;
                align-items: center;
                justify-content: center;
                margin-bottom: 20px;
            }
            .logo {
                width: 50px;
                height: 50px;
                margin-right: 15px;
                background-color: var(--color-contraste);
                border-radius: 50%;
                overflow: hidden;
                display: flex;
                align-items: center;
                justify-content: center;
            }
            .logo img {
                /* IMPORTANTE: Ajusta el nombre del archivo del logo aqu√≠ */
                content: url("Captura de pantalla 2025-10-09 183230.png");
                width: 100%;
                height: 100%;
                object-fit: cover;
            }
            .container {
                max-width: 900px;
                margin: 30px auto;
                padding: 30px;
                background-color: var(--color-dominante);
                border-radius: 15px;
                box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            }
            h1 {
                color: var(--color-contraste);
                text-align: center;
                border-bottom: 2px solid var(--color-acento);
                padding-bottom: 10px;
                margin-bottom: 20px;
            }
            h2 {
                color: var(--color-contraste);
                font-size: 1.3em;
                margin-top: 20px;
                padding-bottom: 5px;
                border-bottom: 1px dashed var(--color-acento);
            }
            .input-group {
                display: flex;
                gap: 15px;
                align-items: center;
                margin-bottom: 20px;
            }
            .input-group label {
                font-weight: bold;
                color: var(--color-contraste);
                white-space: nowrap;
            }
            input[type="text"], input[type="number"] {
                padding: 12px;
                border: 1px solid var(--color-contraste);
                border-radius: 8px;
                font-size: 1em;
                box-sizing: border-box;
            }
            input[type="text"] { flex: 2; }
            input[type="number"] { flex: 1; max-width: 120px; text-align: center; }


            button {
                padding: 12px 20px;
                cursor: pointer;
                background-color: var(--color-contraste);
                color: white;
                border: none;
                border-radius: 8px;
                font-size: 1em;
                transition: background-color 0.3s;
            }
            button:hover { background-color: #5d49b2; }

            button.reset-btn {
                background-color: var(--color-acento);
                color: var(--color-texto-general);
            }
            button.reset-btn:hover {
                background-color: #88c8c5;
            }

            .export-controls {
                text-align: right;
                margin-bottom: 15px;
            }
            button.export-btn {
                background-color: var(--color-acento);
                color: var(--color-texto-general);
                padding: 8px 15px;
                font-size: 0.9em;
            }
            button.export-btn:hover {
                background-color: #88c8c5;
            }

            #statusMessage {
                color: #d9534f;
                margin-top: 15px;
                font-weight: bold;
            }
            .results-grid {
                display: flex;
                gap: 20px;
                margin-top: 20px;
            }
            .column {
                flex: 1;
                padding: 15px;
                border-radius: 10px;
                background-color: var(--color-secundario);
                box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.05);
            }
            .cups-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 10px;
                margin-bottom: 8px;
                background-color: white;
                border: 1px solid var(--color-acento);
                border-radius: 6px;
            }
            .cups-info {
                display: flex;
                align-items: center;
                gap: 10px;
            }
            .list-number {
                font-weight: bold;
                color: white;
                background-color: var(--color-contraste);
                padding: 4px 8px;
                border-radius: 4px;
                font-size: 0.9em;
            }
            .cups-code {
                font-family: monospace;
                font-size: 1.05em;
                color: var(--color-contraste);
                font-weight: bold;
            }
            
            .nota-input {
                padding: 0 6px;    
                border: 1px solid var(--color-acento);
                border-radius: 4px;  
                font-size: 0.7em;    
                width: 120px; 
                box-sizing: border-box; 
                font-family: monospace;
                color: var(--color-texto-general);
            }

            .copy-btn {
                padding: 6px 10px;
                background-color: var(--color-acento);
                color: var(--color-texto-general);
                font-size: 0.9em;
            }
            .copy-btn:hover { background-color: #88c8c5; }

            .copy-btn.copied {
                background-color: var(--color-secundario);
                color: var(--color-texto-general);
                border: 1px solid var(--color-acento);
            }
            .copy-btn.copied:hover {
                background-color: #88c8c5;
            }


            .original-cups {
                background-color: #FFDDAA;
                color: var(--color-texto-general);
                padding: 15px;
                border-radius: 10px;
                text-align: center;
                margin-top: 15px;
                font-size: 1.2em;
                font-weight: bold;
            }


            /* NOTIFICACI√ìN TEMPORAL (Snackbar) */
            #snackbar {
                visibility: hidden;
                min-width: 280px;
                margin-left: -140px;
                background-color: var(--color-contraste);
                color: white;
                text-align: center;
                border-radius: 8px;
                padding: 16px;
                position: fixed;
                z-index: 1000;
                left: 50%;
                bottom: 30px;
                font-size: 1em;
                font-weight: bold;
                box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            }


            #snackbar.show {
                visibility: visible;
                -webkit-animation: fadein 0.5s, fadeout 0.5s 2.5s;
                animation: fadein 0.5s, fadeout 0.5s 2.5s;
            }


            @-webkit-keyframes fadein {
                from {bottom: 0; opacity: 0;}
                to {bottom: 30px; opacity: 1;}
            }
            @keyframes fadein {
                from {bottom: 0; opacity: 0;}
                to {bottom: 30px; opacity: 1;}
            }


            @-webkit-keyframes fadeout {
                from {bottom: 30px; opacity: 1;}
                to {bottom: 0; opacity: 0;}
            }
            @keyframes fadeout {
                from {bottom: 30px; opacity: 1;}
                to {bottom: 0; opacity: 0;}
            }

            /* --- NUEVO: Pie de p√°gina discreto --- */
            .page-footer {
                text-align: center;
                padding: 20px;
                font-size: 0.8em;
                color: var(--color-texto-general);
                opacity: 0.7; /* Lo hace semi-transparente */
            }
            /* --- FIN NUEVO --- */
        </style>
</head>
<body>
        <div class="container">
            <div class="header">
                <div class="logo">
                    </div>
                <h1>Generador de CUPS </h1>
            </div>


            <p>Introduce el CUPS base y la cantidad de c√≥digos anteriores y posteriores que deseas generar.</p>


            <div class="input-group">
                <label for="cupsInput">CUPS Base:</label>
                <input type="text" id="cupsInput" placeholder="Ej: ES0022000000000000" value="ES0022000000000000XX">
           
                <label for="quantityInput">Cantidad:</label>
                <input type="number" id="quantityInput" value="10" min="1" max="50">
           
                <button onclick="generarCups()">Generar</button>
                
                <button onclick="restablecerTodo()" class="reset-btn">Restablecer</button>
            </div>
            <div id="statusMessage"></div>
            <div id="originalCupsDisplay" class="original-cups" style="display: none;"></div>


            <hr>

            <div class="export-controls">
                <button id="exportButton" class="export-btn" onclick="copiarTodoAExcel()" style="display: none;">
                    Copiar Todo para Excel üìã
                </button>
            </div>


            <div class="results-grid">
                <div class="column">
                    <h2 id="anterioresTitle">CUPS Anteriores ‚¨ÖÔ∏è</h2>
                    <div id="anterioresList">
                        </div>
                </div>
                <div class="column">
                    <h2 id="posterioresTitle">CUPS Posteriores ‚û°Ô∏è</h2>
                    <div id="posterioresList">
                        </div>
                </div>
            </div>
        </div> <footer class="page-footer">
            Creado por Fran T.
        </footer>
        <div id="snackbar"></div>


        <script>
            // Obtener referencias del DOM
            const cupsInput = document.getElementById('cupsInput');
            const quantityInput = document.getElementById('quantityInput');
            const anterioresList = document.getElementById('anterioresList');
            const posterioresList = document.getElementById('posterioresList');
            const originalesDisplay = document.getElementById('originalCupsDisplay');
            const statusMessage = document.getElementById('statusMessage');
            const anterioresTitle = document.getElementById('anterioresTitle');
            const posterioresTitle = document.getElementById('posterioresTitle');
            const snackbar = document.getElementById('snackbar');
            const exportButton = document.getElementById('exportButton');


            /* REGEX:
               Grupo 1: LL (ES)
               Grupo 2: DDDD (0022)
               Grupo 3: CCCCCCCCCC (000000000000)
               (Grupo no capturado): EE (XX) - D√≠gitos de control opcionales (?:[A-Z]{2})?
               Grupo 4: Final opcional (PF, 01, etc.) ([A-Z0-9]{0,2})?
            */
            const CUPS_REGEX = /^([A-Z]{2})(\d{4})(\d{12})(?:[A-Z]{2})?([A-Z0-9]{0,2})?/;
            const CUPS_CHAR_TABLE = "TRWAGMYFPDXBNJZSQVHLCKE";


            /**
             * Muestra la notificaci√≥n temporalmente (Snackbar).
             */
            function showSnackbar(message) {
                snackbar.textContent = message;
                snackbar.classList.add('show');
           
                setTimeout(function(){
                    snackbar.classList.remove('show');
                }, 3000);
            }


            /**
             * Calcula los 2 d√≠gitos de control (EE) para los 16 d√≠gitos num√©ricos.
             */
            function calcularDigitosControl(dddccccccccccc) {
                const numero16Digitos = BigInt(dddccccccccccc);
           
                // R0 = DDDDCCCCCCCCCCCC Modulo 529
                const R0 = Number(numero16Digitos % 529n);


                // C = parte entera de R0 / 23; R = R0 Modulo 23
                const C = Math.floor(R0 / 23);
                const R = R0 % 23;


                // Transformar C y R por la tabla
                const letraC = CUPS_CHAR_TABLE.charAt(C);
                const letraR = CUPS_CHAR_TABLE.charAt(R);


                return letraC + letraR;
            }


            /**
             * Copia un texto dado al portapapeles.
             */
            async function copiarAlPortapapeles(textToCopy, btnElement) {
                try {
                    await navigator.clipboard.writeText(textToCopy);
                    showSnackbar(`‚úÖ CUPS copiado: ${textToCopy}`);
                    
                    if (btnElement) {
                        btnElement.classList.add('copied');
                        btnElement.textContent = '‚úî';
                    }

                } catch (err) {
                    console.error('Error al copiar el texto: ', err);
                    alert('‚ùå Error al intentar copiar al portapapeles. Aseg√∫rate de que tu navegador lo permite (la p√°gina debe ser servida por HTTPS o localhost).');
                }
            }


            /**
             * Funci√≥n para copiar todos los datos a Excel
             */
            async function copiarTodoAExcel() {
                let excelData = "";
                const tab = '\t'; // Car√°cter Tabulador (clave para separar columnas en Excel)
                const newline = '\n'; // Salto de l√≠nea

                // 1. Obtener todos los items
                const itemsAnteriores = document.querySelectorAll('#anterioresList .cups-item');
                const itemsPosteriores = document.querySelectorAll('#posterioresList .cups-item');
                
                // 2. Procesar "Anteriores"
                // (Los procesamos en orden inverso para que al pegarlos queden del m√°s antiguo al m√°s nuevo)
                const itemsAnterioresArray = Array.from(itemsAnteriores).reverse();
                itemsAnterioresArray.forEach(item => {
                    const cups = item.querySelector('.cups-code').textContent;
                    const nota = item.querySelector('.nota-input').value;
                    excelData += `${cups}${tab}${nota}${newline}`;
                });

                // 3. Procesar "Posteriores"
                itemsPosteriores.forEach(item => {
                    const cups = item.querySelector('.cups-code').textContent;
                    const nota = item.querySelector('.nota-input').value;
                    excelData += `${cups}${tab}${nota}${newline}`;
                });

                // 4. Copiar al portapapeles
                if (excelData) {
                    try {
                        await navigator.clipboard.writeText(excelData.trim());
                        showSnackbar('‚úÖ Todos los CUPS y notas copiados para pegar en un Excel.');
                    } catch (err) {
                        console.error('Error al copiar todo: ', err);
                        alert('‚ùå Error al copiar. Revisa los permisos del navegador.');
                    }
                } else {
                    showSnackbar('‚ÑπÔ∏è No hay datos para copiar.');
                }
            }


            /**
             * Funci√≥n auxiliar para calcular el CUPS completo (parte del BigInt y control).
             */
            function calculateFullCups(baseNumber, countryCode, distributorCode, optionalEnd) {
                const newNumericPart = baseNumber.toString().padStart(12, '0');
                const dddccccccccccc = distributorCode + newNumericPart;
                const newControlDigits = calcularDigitosControl(dddccccccccccc);
           
                return `${countryCode}${distributorCode}${newNumericPart}${newControlDigits}${optionalEnd || ''}`;
            }


            /**
             * Funci√≥n principal para generar y mostrar los CUPS secuenciales.
             */
            function generarCups() {
                const fullCups = cupsInput.value.trim().toUpperCase();
                let quantity = parseInt(quantityInput.value, 10);
           
                if (isNaN(quantity) || quantity < 1 || quantity > 50) { 
                    quantity = 10;
                    quantityInput.value = 10;
                    statusMessage.textContent = 'Cantidad ajustada a 10 (m√≠n: 1, m√°x: 50).';
                } else {
                    statusMessage.textContent = '';
                }
           
                // Limpiar resultados anteriores
                anterioresList.innerHTML = '';
                posterioresList.innerHTML = '';
                originalesDisplay.style.display = 'none';
                exportButton.style.display = 'none'; 
           
                // Actualizar t√≠tulos
                anterioresTitle.textContent = `${quantity} CUPS Anteriores ‚¨ÖÔ∏è`;
                posterioresTitle.textContent = `${quantity} CUPS Posteriores ‚û°Ô∏è`;


                const match = fullCups.match(CUPS_REGEX);


                if (!match) {
                    statusMessage.textContent = 'Formato CUPS inv√°lido. Debe empezar con LLDDDDCCCCCCCCCCCC (18 caracteres).';
                    return;
                }

                const [_, countryCode, distributorCode, numericPart, optionalEnd] = match;
                const baseNumber = parseInt(numericPart, 10);
           
                // 1. Procesar CUPS anteriores (El √≠ndice 'i' es el n√∫mero de lista.)
                for (let i = 1; i <= quantity; i++) {
                    const itemNumber = baseNumber - i;
                    const newCups = calculateFullCups(itemNumber, countryCode, distributorCode, optionalEnd);
                    displayCupsItem(newCups, anterioresList, i);
                }
           
                // 2. Procesar CUPS posteriores (El √≠ndice 'i' es el n√∫mero de lista.)
                for (let i = 1; i <= quantity; i++) {
                    const itemNumber = baseNumber + i;
                    const newCups = calculateFullCups(itemNumber, countryCode, distributorCode, optionalEnd);
                    displayCupsItem(newCups, posterioresList, i);
                }

                
                // 3. Mostrar el CUPS Original
                const completeBaseCups = calculateFullCups(baseNumber, countryCode, distributorCode, optionalEnd);
                originalesDisplay.textContent = `CUPS Original: ${completeBaseCups}`;
                originalesDisplay.style.display = 'block';
                
                exportButton.style.display = 'inline-block';
            }

            
            /**
             * Funci√≥n para restablecer la interfaz
             */
            function restablecerTodo() {
                // Restablecer valores de entrada a sus valores por defecto
                cupsInput.value = 'ES0022000000000000XX'; 
                quantityInput.value = '10';

                // Limpiar listas de resultados
                anterioresList.innerHTML = '';
                posterioresList.innerHTML = '';

                // Limpiar mensaje de estado
                statusMessage.textContent = '';

                // Ocultar el display del CUPS original
                originalesDisplay.style.display = 'none';

                exportButton.style.display = 'none';

                // Restablecer t√≠tulos de las columnas
                anterioresTitle.textContent = 'CUPS Anteriores ‚¨ÖÔ∏è';
                posterioresTitle.textContent = 'CUPS Posteriores ‚û°Ô∏è';
            }


            /**
             * Crea y a√±ade un elemento de lista para un CUPS.
             */
            function displayCupsItem(cupsCode, targetList, listNumber) {
                const itemDiv = document.createElement('div');
                itemDiv.classList.add('cups-item');


                const cupsInfo = document.createElement('div');
                cupsInfo.classList.add('cups-info');
           
                // N√∫mero de lista
                const numberSpan = document.createElement('span');
                numberSpan.classList.add('list-number');
                numberSpan.textContent = listNumber;


                // C√≥digo CUPS
                const cupsSpan = document.createElement('span');
                cupsSpan.classList.add('cups-code');
                cupsSpan.textContent = cupsCode;


                cupsInfo.appendChild(numberSpan);
                cupsInfo.appendChild(cupsSpan);
           
                // Campo de Notas
                const notaInput = document.createElement('input');
                notaInput.type = 'text';
                notaInput.classList.add('nota-input');
                notaInput.placeholder = '';
                notaInput.maxLength = 100;
                cupsInfo.appendChild(notaInput);


                // Bot√≥n de copia
                const copyButton = document.createElement('button');
                copyButton.classList.add('copy-btn');
                copyButton.textContent = 'Copiar';
                
                copyButton.onclick = () => copiarAlPortapapeles(cupsCode, copyButton);


                itemDiv.appendChild(cupsInfo);
                itemDiv.appendChild(copyButton);
           
                targetList.appendChild(itemDiv);
            }


            // Hacemos las funciones accesibles globalmente
            window.copiarAlPortapapeles = copiarAlPortapapeles;
            window.generarCups = generarCups;
            window.restablecerTodo = restablecerTodo;
            window.copiarTodoAExcel = copiarTodoAExcel;
        </script>
</body>

</html>

</html>


